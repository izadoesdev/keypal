---
title: Audit Logging
description: Track all key operations with audit logs
icon: FileText
---

# Audit Logging

Audit logging tracks all key operations with context about who performed each action.

## Enabling Audit Logging

```typescript
const keys = createKeys({
  auditLogs: true,
  auditContext: {
    // Default context merged into all logs
    userId: 'system',
    metadata: { environment: 'production' },
  },
})
```

## Automatic Logging

Actions are automatically logged when audit logging is enabled:

- **Created**: When a key is created
- **Revoked**: When a key is revoked
- **Rotated**: When a key is rotated
- **Enabled**: When a key is enabled
- **Disabled**: When a key is disabled

## Adding Context

```typescript
await keys.create({
  ownerId: 'user_123',
  scopes: ['read'],
}, {
  userId: 'admin_456',
  ip: '192.168.1.1',
  metadata: { reason: 'New customer onboarding' },
})

await keys.revoke('key_123', {
  userId: 'admin_789',
  metadata: { reason: 'Security breach' },
})
```

## Querying Logs

```typescript
// Get logs for a specific key
const logs = await keys.getLogs({
  keyId: 'key_123',
  limit: 100,
})

// Get logs by action
const revokedLogs = await keys.getLogs({
  action: 'revoked',
  startDate: '2025-01-01',
})

// Get logs for an owner
const ownerLogs = await keys.getLogs({
  ownerId: 'user_123',
})
```

## Counting Logs

```typescript
const count = await keys.countLogs({
  action: 'created',
  startDate: '2025-01-01',
})
```

## Statistics

```typescript
const stats = await keys.getLogStats('user_123')

console.log(stats.total)              // Total number of logs
console.log(stats.byAction.created)   // Number of created actions
console.log(stats.lastActivity)       // Last activity timestamp
```

## Cleaning Up Logs

```typescript
// Delete old logs
const deleted = await keys.deleteLogs({
  endDate: '2024-01-01',
})

// Clear logs for a specific key
await keys.clearLogs('key_123')
```

## Log Entry Structure

```typescript
{
  id: 'log_xyz',
  action: 'created' | 'revoked' | 'rotated' | 'enabled' | 'disabled',
  keyId: 'key_123',
  ownerId: 'user_456',
  timestamp: '2025-10-25T12:00:00.000Z',
  data: {
    userId: 'admin_789',
    ip: '192.168.1.1',
    metadata: { reason: 'Security breach' },
  },
}
```

